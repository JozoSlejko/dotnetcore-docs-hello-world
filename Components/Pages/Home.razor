@page "/"
@using System.Security.Claims
@inject AuthenticationStateProvider AuthenticationStateProvider

<PageTitle>Home</PageTitle>

<h1>Hello, world!</h1>

Welcome to your new app.

<a href="/.auth/login/aad">Log in with Microsoft Entra</a>
<a href="/.auth/login/slejcooidc">Log in with Slejco OIDC</a>

<p style="margin-top: 1rem;">
    <a href="@WindowsCloudUrl" target="_blank" rel="noopener noreferrer">
        Open Windows Cloud
    </a>
</p>

@code {
    private const string WindowsCloudBaseUrl =
        "https://windows.cloud.microsoft/webclient/avd/d8817eb0-d704-4641-a3dd-70025b07ae56/df0c4b56-b1ff-43f0-8fd4-08de563faf68";

    private string WindowsCloudUrl { get; set; } = WindowsCloudBaseUrl;

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;

        if (user?.Identity?.IsAuthenticated == true)
        {
            // Best-effort: prefer email-style identifiers (works with Auth0 OIDC and Entra member accounts).
            var loginHint =
                user.FindFirst("http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress")?.Value
                ?? user.FindFirst("preferred_username")?.Value
                ?? user.FindFirst(ClaimTypes.Email)?.Value
                ?? user.FindFirst("email")?.Value
                ?? user.Identity?.Name;

            if (!string.IsNullOrWhiteSpace(loginHint))
            {
                WindowsCloudUrl = $"{WindowsCloudBaseUrl}#loginHint={Uri.EscapeDataString(loginHint)}";
            }
        }
    }
}